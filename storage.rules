rules_version = '2';

// Firebase Storage Security Rules
service firebase.storage {
  match /b/{bucket}/o {
    // Rules for product images
    match /products/{imageId} {
      // Allow read for everyone
      allow read: if true;
      
      // Allow write (upload, update, delete) only for authenticated admin users
      allow write: if request.auth != null 
                   && request.auth.token.role == 'admin'
                   && isValidImage();
    }
    
    // Rules for user profile images (if needed in the future)
    match /users/{userId}/{imageId} {
      // Allow read for everyone
      allow read: if true;
      
      // Allow write only for the user themselves or admin
      allow write: if request.auth != null 
                   && (request.auth.uid == userId || request.auth.token.role == 'admin')
                   && isValidImage();
    }
    
    // Helper function to validate image uploads
    function isValidImage() {
      return request.resource.size < 5 * 1024 * 1024 && // Max 5MB
             request.resource.contentType.matches('image/.*'); // Only images
    }
  }
}
